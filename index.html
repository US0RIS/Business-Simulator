<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Empire Simulator</title>
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #0d0d0d;
            --bg-tertiary: #000;
            --border-color: #00ff00;
            --text-primary: #00ff00;
            --text-secondary: #00ffff;
            --text-warning: #ff0000;
            --button-bg: #003300;
            --button-hover: #00ff00;
        }
        .theme-modern {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #fafafa;
            --border-color: #4caf50;
            --text-primary: #212121;
            --text-secondary: #1976d2;
            --text-warning: #d32f2f;
            --button-bg: #4caf50;
            --button-hover: #66bb6a;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            transition: all 0.3s;
        }
        body.theme-modern { font-family: 'Segoe UI', sans-serif; }
        .game-container {
            border: 2px solid var(--border-color);
            padding: 20px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
        }
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--button-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 10px;
            cursor: pointer;
            border-radius: 4px;
            z-index: 999;
        }
        .settings-panel {
            position: fixed;
            top: 60px;
            right: 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 300px;
        }
        .company-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        .company-tab {
            background: var(--button-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 10px;
            cursor: pointer;
            white-space: nowrap;
            min-width: 150px;
            text-align: center;
            border-radius: 4px;
        }
        .company-tab.active {
            background: var(--button-hover);
            color: var(--bg-primary);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        .stat-item {
            padding: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        .event-container {
            border: 2px solid var(--border-color);
            padding: 20px;
            margin-bottom: 20px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }
        .event-title {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        .choices { display: grid; gap: 10px; }
        .choice-button {
            background: var(--button-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 15px;
            cursor: pointer;
            font-family: inherit;
            text-align: left;
            border-radius: 4px;
        }
        .choice-button:hover:not(:disabled) {
            background: var(--button-hover);
            color: var(--bg-primary);
        }
        .choice-button:disabled { opacity: 0.3; cursor: not-allowed; }
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }
        .action-button {
            background: var(--button-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 10px;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
            text-align: center;
            border-radius: 4px;
        }
        .action-button:hover:not(:disabled) {
            background: var(--button-hover);
            color: var(--bg-primary);
        }
        .action-button:disabled { opacity: 0.3; cursor: not-allowed; }
        button {
            background: var(--button-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 12px;
            cursor: pointer;
            font-family: inherit;
            border-radius: 4px;
        }
        button:hover { background: var(--button-hover); color: var(--bg-primary); }
        .title {
            text-align: center;
            font-size: 28px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }
        .warning { color: var(--text-warning); }
        .success { color: var(--text-secondary); }
        .business-type {
            border: 1px solid var(--border-color);
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        .business-type:hover { background: var(--button-bg); }
        .business-type.selected { background: var(--button-hover); color: var(--bg-primary); }
        .hidden { display: none; }
        .tab-buttons { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; }
        .tab-button { flex: 1; padding: 10px; font-size: 12px; min-width: 100px; }
        .tab-button.active { background: var(--button-hover); color: var(--bg-primary); }
        .action-log {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 10px;
            margin-bottom: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 11px;
            border-radius: 4px;
        }
        .loan-section {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .debt-warning {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid var(--text-warning);
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        input, select {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px;
            font-family: inherit;
            width: 100%;
            margin: 10px 0;
            border-radius: 4px;
        }
        @media (max-width: 768px) {
            .actions { grid-template-columns: 1fr; }
            .stats { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
    
    <div id="settingsPanel" class="settings-panel hidden">
        <h3>Settings</h3>
        <label>Theme:</label>
        <select id="themeSelect" onchange="changeTheme()">
            <option value="retro">Retro</option>
            <option value="modern">Modern</option>
        </select>
        <button onclick="toggleSettings()" style="width: 100%; margin-top: 10px;">Close</button>
    </div>

    <div class="game-container">
        <div class="title">BUSINESS EMPIRE SIMULATOR</div>
        
        <div id="setupScreen">
            <h2>Create Your Business</h2>
            <input type="text" id="playerName" placeholder="Your name" value="Alex Smith">
            <input type="text" id="companyName" placeholder="Company name" value="TechCorp">
            
            <h3>Choose Business Type:</h3>
            <div class="business-type" onclick="selectBusiness('tech')">
                <strong>üñ•Ô∏è Tech Startup</strong><br>
                High growth, high risk | $8K | 2 employees
            </div>
            <div class="business-type" onclick="selectBusiness('retail')">
                <strong>üõçÔ∏è Retail Store</strong><br>
                Steady income | $10K | 3 employees
            </div>
            <div class="business-type" onclick="selectBusiness('restaurant')">
                <strong>üçΩÔ∏è Restaurant</strong><br>
                High volume, quality-critical | $7K | 4 employees
            </div>
            <div class="business-type" onclick="selectBusiness('consulting')">
                <strong>üíº Consulting</strong><br>
                Reputation-dependent | $12K | 2 employees
            </div>
            <div class="business-type" onclick="selectBusiness('ecommerce')">
                <strong>üì¶ E-Commerce</strong><br>
                Online sales, scalable | $9K | 2 employees
            </div>
            
            <button onclick="startGame()" style="width: 100%; padding: 15px; margin-top: 15px;">Start Journey</button>
        </div>

        <div id="gameScreen" class="hidden">
            <div id="portfolioSummary" class="hidden" style="background: var(--bg-tertiary); padding: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
                <strong>üìä Portfolio:</strong> <span id="portfolioContent"></span>
            </div>

            <div id="debtWarning" class="debt-warning hidden"></div>
            <div id="companySelector" class="company-selector"></div>

            <div class="stats">
                <div class="stat-item">üí∞ $<span id="cash">0</span></div>
                <div class="stat-item">üìÖ Month <span id="month">1</span></div>
                <div class="stat-item">üë• <span id="employees">0</span> empl.</div>
                <div class="stat-item">‚≠ê Rep: <span id="reputation">0</span></div>
                <div class="stat-item">üë§ <span id="customers">0</span> cust.</div>
                <div class="stat-item">‚ú® Qual: <span id="quality">0</span></div>
                <div class="stat-item">üìä +$<span id="revenue">0</span>/mo</div>
                <div class="stat-item">üí∏ -$<span id="expenses">0</span>/mo</div>
                <div class="stat-item">üòä Morale: <span id="morale">0</span></div>
                <div class="stat-item">üí≥ Debt: <span id="debtCapacity">0</span>%</div>
            </div>

            <div id="monthlyReportScreen" class="hidden">
                <div style="background: var(--bg-tertiary); padding: 15px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
                    <h3>üìä Month <span id="reportMonth"></span> Report</h3>
                    <div id="reportContent"></div>
                </div>
                <button onclick="showEvent()" style="width: 100%; padding: 15px;">Continue to Event</button>
            </div>

            <div id="eventScreen" class="hidden">
                <div class="event-container">
                    <div class="event-title" id="eventTitle"></div>
                    <div id="eventDescription" style="margin-bottom: 20px; line-height: 1.6;"></div>
                    <div class="choices" id="eventChoices"></div>
                </div>
            </div>

            <div id="freeActionScreen" class="hidden">
                <div style="border: 2px solid var(--border-color); padding: 20px; margin-bottom: 20px; background: var(--bg-tertiary); border-radius: 8px;" id="eventResult"></div>
                
                <div class="loan-section">
                    <strong>üíµ Loans (Debt: <span id="currentDebt">0</span>%)</strong>
                    <button class="action-button" onclick="quickLoan(5000, 250, 24)" style="width: 100%; margin: 5px 0;">
                        +$5K (-$250/mo) [Max 20%]
                    </button>
                    <button class="action-button" onclick="quickLoan(10000, 500, 24)" style="width: 100%; margin: 5px 0;">
                        +$10K (-$500/mo) [Max 30%]
                    </button>
                    <button class="action-button" onclick="quickLoan(30000, 1500, 24)" style="width: 100%; margin: 5px 0;">
                        +$30K (-$1500/mo) [50%, Rep 50+]
                    </button>
                </div>

                <div class="action-log">
                    <strong>Actions:</strong><br>
                    <span id="logContent">No actions taken.</span>
                </div>

                <div class="tab-buttons">
                    <button class="tab-button active" onclick="showTab('ops')">Operations</button>
                    <button class="tab-button" onclick="showTab('growth')">Growth</button>
                    <button class="tab-button" onclick="showTab('finance')">Finance</button>
                    <button class="tab-button" onclick="showTab('marketing')">Marketing</button>
                    <button class="tab-button" onclick="showTab('empire')">Empire</button>
                </div>

                <div id="opsTab" class="actions">
                    <button class="action-button" onclick="act('hire')">Hire Employee<br>-$2500</button>
                    <button class="action-button" onclick="act('fire')">Fire Employee<br>+$800</button>
                    <button class="action-button" onclick="act('train')">Train Staff<br>-$1500</button>
                    <button class="action-button" onclick="act('wages')">Raise Wages<br>Varies</button>
                    <button class="action-button" onclick="act('workplace')">Improve Workplace<br>-$3000</button>
                    <button class="action-button" onclick="act('automate')">Automate<br>-$5000</button>
                    <button class="action-button" onclick="act('quality')">Quality Control<br>-$2000</button>
                    <button class="action-button" onclick="act('cs')">Customer Service<br>-$1800</button>
                    <button class="action-button" onclick="act('maintain')">Maintenance<br>-$1000</button>
                </div>

                <div id="growthTab" class="actions hidden">
                    <button class="action-button" onclick="act('expand')">New Location<br>-$15000</button>
                    <button class="action-button" onclick="act('product')">New Product<br>-$8000</button>
                    <button class="action-button" onclick="act('partner')">Partnership<br>-$4000</button>
                    <button class="action-button" onclick="act('franchise')">Franchise<br>-$12000</button>
                    <button class="action-button" onclick="act('acquire')">Acquire Competitor<br>-$25000</button>
                    <button class="action-button" onclick="act('intl')">Go International<br>-$35000</button>
                </div>

                <div id="financeTab" class="actions hidden">
                    <button class="action-button" onclick="act('investor')">Seek Investor<br>Dilutes equity</button>
                    <button class="action-button" onclick="act('cut')">Cut Costs<br>Harsh</button>
                    <button class="action-button" onclick="act('stocks')">Invest Stocks<br>-$5000</button>
                    <button class="action-button" onclick="act('realestate')">Real Estate<br>-$18000</button>
                    <button class="action-button" onclick="act('refinance')">Refinance<br>-$3000</button>
                    <button class="action-button" onclick="act('payoff')">Pay Off Loan<br>Varies</button>
                </div>

                <div id="marketingTab" class="actions hidden">
                    <button class="action-button" onclick="act('marketing')">Campaign<br>-$3500</button>
                    <button class="action-button" onclick="act('social')">Social Media<br>-$1200</button>
                    <button class="action-button" onclick="act('pr')">PR Campaign<br>-$2500</button>
                    <button class="action-button" onclick="act('rebrand')">Rebrand<br>-$5000</button>
                    <button class="action-button" onclick="act('influencer')">Influencer<br>-$4000</button>
                    <button class="action-button" onclick="act('seo')">SEO<br>-$3000</button>
                </div>

                <div id="empireTab" class="actions hidden">
                    <button class="action-button" onclick="act('newco')">Start Company<br>-$20000</button>
                    <button class="action-button" onclick="act('transfer')">Transfer Funds<br>Between cos</button>
                    <button class="action-button" onclick="act('cross')">Cross-Promote<br>-$2000</button>
                    <button class="action-button" onclick="act('merge')">Merge<br>Combine two</button>
                    <button class="action-button" onclick="act('sell')">Sell Company<br>Exit</button>
                </div>

                <button onclick="nextMonth()" style="width: 100%; padding: 15px; margin-top: 15px; font-size: 16px;">‚ñ∫ NEXT MONTH</button>
            </div>

            <div id="victoryScreen" class="hidden">
                <div style="border: 2px solid var(--border-color); padding: 20px; background: var(--bg-tertiary); border-radius: 8px;">
                    <h2 class="success">üéâ MILESTONE! üéâ</h2>
                    <div id="victoryContent"></div>
                </div>
                <button onclick="continueAfterVictory()" style="width: 100%; padding: 15px; margin: 10px 0;">Continue</button>
                <button onclick="resetGame()" style="width: 100%; padding: 15px;">New Game</button>
            </div>

            <div id="gameOverScreen" class="hidden">
                <div style="border: 2px solid var(--border-color); padding: 20px; background: var(--bg-tertiary); border-radius: 8px;">
                    <h2 class="warning">üíÄ BANKRUPTCY üíÄ</h2>
                    <div id="gameOverContent"></div>
                </div>
                <button onclick="closeCompany()" style="width: 100%; padding: 15px; margin: 10px 0;">Close Company</button>
                <button onclick="resetGame()" style="width: 100%; padding: 15px;">New Game</button>
            </div>
        </div>
    </div>

    <script>
        let selectedBiz = null, currentTab = 'ops', actions = [], companies = [], activeIdx = 0, nextId = 1;

        const bizTypes = {
            tech: { name: 'Tech Startup', cash: 8000, emp: 2, qual: 40, cust: 30, rep: 35, rev: 3500, exp: 2800 },
            retail: { name: 'Retail Store', cash: 10000, emp: 3, qual: 50, cust: 80, rep: 45, rev: 5000, exp: 3200 },
            restaurant: { name: 'Restaurant', cash: 7000, emp: 4, qual: 45, cust: 60, rep: 40, rev: 6000, exp: 4500 },
            consulting: { name: 'Consulting', cash: 12000, emp: 2, qual: 60, cust: 20, rep: 55, rev: 7000, exp: 2500 },
            ecommerce: { name: 'E-Commerce', cash: 9000, emp: 2, qual: 45, cust: 50, rep: 38, rev: 4000, exp: 2600 }
        };

        const events = {
            quality: [
                { title: "Quality Issues", desc: "Customers complaining about quality problems.", choices: [
                    { text: "Refund + apology (-$500, Rep +5)", cost: 500, effects: { rep: 5, cust: -5 } },
                    { text: "Hire QA team (-$3000, Qual +15)", cost: 3000, effects: { qual: 15, emp: 1 } },
                    { text: "Ignore (Rep -15, Cust -20)", cost: 0, effects: { rep: -15, cust: -20 } }
                ]},
                { title: "Equipment Failure", desc: "Critical equipment broken. Production halted.", choices: [
                    { text: "Emergency fix (-$4000, Qual +5)", cost: 4000, effects: { qual: 5 } },
                    { text: "Cheap repair (-$1500, Qual -5)", cost: 1500, effects: { qual: -5 } },
                    { text: "Upgrade (-$8000, Qual +20)", cost: 8000, effects: { qual: 20, exp: 200 } }
                ]}
            ],
            employee: [
                { title: "Key Employee Leaving", desc: "Top performer has better offer elsewhere.", choices: [
                    { text: "Match offer (Exp +$1200/mo)", cost: 0, effects: { exp: 1200, morale: 10 } },
                    { text: "Let go (-$2500, Qual -10)", cost: 2500, effects: { qual: -10 } },
                    { text: "Promote intern (-$1000, Morale +5)", cost: 1000, effects: { morale: 5 } }
                ]},
                { title: "Low Morale", desc: "Team morale at all-time low.", choices: [
                    { text: "Team retreat (-$3500, Morale +25)", cost: 3500, effects: { morale: 25 } },
                    { text: "Raise salaries (Exp +$1500/mo)", cost: 0, effects: { exp: 1500, morale: 20 } },
                    { text: "Do nothing (Morale -10, -1 emp)", cost: 0, effects: { morale: -10, emp: -1 } }
                ]}
            ],
            customer: [
                { title: "Major Client", desc: "Large client wants exclusivity deal.", choices: [
                    { text: "Accept + expand (-$8000, Rev +$2500/mo)", cost: 8000, effects: { rev: 2500, emp: 2 } },
                    { text: "Smaller deal (-$2000, Rev +$1200/mo)", cost: 2000, effects: { rev: 1200 } },
                    { text: "Decline", cost: 0, effects: {} }
                ]},
                { title: "Viral Review", desc: "Influencer praised you! Orders flooding in.", choices: [
                    { text: "Scale up (-$6000, Cust +80)", cost: 6000, effects: { cust: 80, emp: 3 } },
                    { text: "Moderate (-$3000, Cust +50)", cost: 3000, effects: { cust: 50 } },
                    { text: "Organic (Cust +20, Qual +10)", cost: 0, effects: { cust: 20, qual: 10 } }
                ]}
            ],
            market: [
                { title: "Competitor Price War", desc: "Competitor slashed prices 30%.", choices: [
                    { text: "Match (Rev -$1500/mo, Cust +20)", cost: 0, effects: { rev: -1500, cust: 20 } },
                    { text: "Quality focus (-$4000, Qual +25)", cost: 4000, effects: { qual: 25, rep: 15 } },
                    { text: "Do nothing (Cust -30)", cost: 0, effects: { cust: -30 } }
                ]},
                { title: "New Market", desc: "Untapped market segment identified.", choices: [
                    { text: "Full expansion (-$12000, Rev +$2500/mo)", cost: 12000, effects: { rev: 2500, cust: 60 } },
                    { text: "Pilot (-$5000, Rev +$1000/mo)", cost: 5000, effects: { rev: 1000, cust: 25 } },
                    { text: "Skip", cost: 0, effects: {} }
                ]}
            ]
        };

        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('hidden');
        }

        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            document.body.className = theme !== 'retro' ? 'theme-' + theme : '';
        }

        function selectBusiness(type) {
            document.querySelectorAll('.business-type').forEach(el => el.classList.remove('selected'));
            event.target.closest('.business-type').classList.add('selected');
            selectedBiz = type;
        }

        function createCo(type, name, first = false) {
            const t = bizTypes[type];
            return {
                id: nextId++, name, type, cash: first ? t.cash : 0, month: 1, emp: t.emp, rep: t.rep,
                cust: t.cust, qual: t.qual, morale: 60, rev: t.rev, exp: t.exp, revBoost: 0, expBoost: 0,
                loans: [], events: [], total: { rev: 0, exp: 0 }, done: 0, used: [], victory: false, cooldowns: {}
            };
        }

        function startGame() {
            const name = document.getElementById('companyName').value || 'TechCorp';
            if (!selectedBiz) return alert('Select business type');
            companies = [createCo(selectedBiz, name, true)];
            activeIdx = 0;
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            updateSelector();
            updateDisplay();
            showReport();
        }

        function updateSelector() {
            const sel = document.getElementById('companySelector');
            sel.innerHTML = '';
            companies.forEach((co, i) => {
                const net = calcRev(co) - calcExp(co);
                const tab = document.createElement('div');
                tab.className = 'company-tab' + (i === activeIdx ? ' active' : '');
                tab.innerHTML = `<strong>${co.name}</strong><br>$${co.cash.toLocaleString()} | ${net >= 0 ? '+' : ''}$${net.toLocaleString()}/mo`;
                tab.onclick = () => switchCo(i);
                sel.appendChild(tab);
            });
            const newTab = document.createElement('div');
            newTab.className = 'company-tab';
            newTab.style.borderStyle = 'dashed';
            newTab.innerHTML = '<strong>+ New</strong>';
            newTab.onclick = () => act('newco');
            sel.appendChild(newTab);
            updatePortfolio();
        }

        function updatePortfolio() {
            if (companies.length > 1) {
                const cash = companies.reduce((s, c) => s + c.cash, 0);
                const rev = companies.reduce((s, c) => s + calcRev(c), 0);
                document.getElementById('portfolioContent').innerHTML = 
                    `${companies.length} cos | $${cash.toLocaleString()} | $${rev.toLocaleString()}/mo`;
                document.getElementById('portfolioSummary').classList.remove('hidden');
            } else {
                document.getElementById('portfolioSummary').classList.add('hidden');
            }
        }

        function switchCo(i) { activeIdx = i; updateSelector(); updateDisplay(); }
        function getCo() { return companies[activeIdx]; }

        function calcRev(co) {
            let r = co.rev + co.emp * 600 / (1 + co.emp * 0.02) + co.cust * 20 / (1 + co.cust * 0.001) + co.revBoost;
            r *= (co.qual / 100 + 0.6) * (co.rep / 100 + 0.6) * (co.morale / 100 * 0.3 + 0.85);
            return Math.max(0, Math.floor(r * (0.85 + Math.random() * 0.3)));
        }

        function calcExp(co) {
            let e = co.exp + co.emp * 600 * (1 + co.emp * 0.01) + co.expBoost;
            co.loans.forEach(l => e += l.monthly);
            return Math.max(0, Math.floor(e * (co.morale < 40 ? 1.15 : 1)));
        }

        function calcDebt(co) {
            const total = co.loans.reduce((s, l) => s + l.monthly, 0);
            return Math.floor((total / calcRev(co)) * 100);
        }

        function updateDisplay() {
            const co = getCo();
            document.getElementById('cash').textContent = co.cash.toLocaleString();
            document.getElementById('month').textContent = co.month;
            document.getElementById('employees').textContent = co.emp;
            document.getElementById('reputation').textContent = Math.max(0, Math.min(100, co.rep));
            document.getElementById('customers').textContent = co.cust;
            document.getElementById('quality').textContent = Math.max(0, Math.min(100, co.qual));
            document.getElementById('morale').textContent = Math.max(0, Math.min(100, co.morale));
            document.getElementById('revenue').textContent = calcRev(co).toLocaleString();
            document.getElementById('expenses').textContent = calcExp(co).toLocaleString();
            const debt = calcDebt(co);
            document.getElementById('debtCapacity').textContent = debt;
            document.getElementById('currentDebt').textContent = debt;
            if (debt > 60) {
                document.getElementById('debtWarning').textContent = `‚ö†Ô∏è HIGH DEBT: ${debt}%`;
                document.getElementById('debtWarning').classList.remove('hidden');
            } else {
                document.getElementById('debtWarning').classList.add('hidden');
            }
        }

        function hideAll() {
            ['monthlyReportScreen', 'eventScreen', 'freeActionScreen', 'victoryScreen', 'gameOverScreen'].forEach(id =>
                document.getElementById(id).classList.add('hidden')
            );
        }

        function showReport() {
            hideAll();
            const co = getCo();
            const rev = calcRev(co), exp = calcExp(co), net = rev - exp;
            co.cash += net;
            co.total.rev += rev;
            co.total.exp += exp;
            co.loans = co.loans.filter(l => { l.months--; if (l.months <= 0) co.exp -= l.monthly; return l.months > 0; });
            Object.keys(co.cooldowns).forEach(k => { if (co.cooldowns[k] > 0) co.cooldowns[k]--; });
            co.qual = Math.max(0, co.qual - 3);
            co.morale = Math.max(0, co.morale - 2);
            co.cust = Math.max(0, Math.floor(co.cust * 0.97));
            co.revBoost = Math.floor(co.revBoost * 0.6);
            document.getElementById('reportMonth').textContent = co.month;
            document.getElementById('reportContent').innerHTML = 
                `<pre>Revenue: <span class="success">+$${rev.toLocaleString()}</span>\nExpenses: <span class="warning">-$${exp.toLocaleString()}</span>\nNet: ${net >= 0 ? '+' : ''}$${net.toLocaleString()}\n\nBalance: $${co.cash.toLocaleString()}</pre>`;
            document.getElementById('monthlyReportScreen').classList.remove('hidden');
            updateDisplay();
            updateSelector();
            if (co.cash >= 100000 && co.rep >= 70 && !co.victory) {
                co.victory = true;
                showVictory();
            } else if (co.cash < -15000) showGameOver();
        }

        function showEvent() {
            hideAll();
            const co = getCo();
            const cats = Object.keys(events);
            const cat = cats[Math.floor(Math.random() * cats.length)];
            const evts = events[cat];
            const evt = evts[Math.floor(Math.random() * evts.length)];
            document.getElementById('eventTitle').textContent = 'üìã ' + evt.title;
            document.getElementById('eventDescription').textContent = evt.desc;
            const container = document.getElementById('eventChoices');
            container.innerHTML = '';
            evt.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-button';
                btn.onclick = () => handleChoice(choice);
                btn.disabled = co.cash < choice.cost;
                btn.innerHTML = choice.text + (co.cash < choice.cost && choice.cost > 0 ? ' [Need $' + choice.cost.toLocaleString() + ']' : '');
                container.appendChild(btn);
            });
            document.getElementById('eventScreen').classList.remove('hidden');
        }

        function handleChoice(choice) {
            hideAll();
            const co = getCo();
            co.cash -= choice.cost;
            let txt = `Event Response:\n\n${choice.text}\n\nEffects:\n`;
            if (choice.cost !== 0) txt += `Cash: ${choice.cost > 0 ? '-' : '+'}$${Math.abs(choice.cost).toLocaleString()}\n`;
            const e = choice.effects;
            if (e.rep) { co.rep += e.rep; txt += `Rep: ${e.rep > 0 ? '+' : ''}${e.rep}\n`; }
            if (e.cust) { co.cust += e.cust; txt += `Cust: ${e.cust > 0 ? '+' : ''}${e.cust}\n`; }
            if (e.qual) { co.qual += e.qual; txt += `Qual: ${e.qual > 0 ? '+' : ''}${e.qual}\n`; }
            if (e.morale) { co.morale += e.morale; txt += `Morale: ${e.morale > 0 ? '+' : ''}${e.morale}\n`; }
            if (e.emp) { co.emp += e.emp; txt += `Emp: ${e.emp > 0 ? '+' : ''}${e.emp}\n`; }
            if (e.rev) { co.rev += e.rev; txt += `Rev: ${e.rev > 0 ? '+' : ''}$${e.rev}/mo\n`; }
            if (e.exp) { co.exp += e.exp; txt += `Exp: ${e.exp > 0 ? '+' : ''}$${e.exp}/mo\n`; }
            co.rep = Math.max(0, Math.min(100, co.rep));
            co.qual = Math.max(0, Math.min(100, co.qual));
            co.morale = Math.max(0, Math.min(100, co.morale));
            co.cust = Math.max(0, co.cust);
            co.emp = Math.max(1, co.emp);
            co.done++;
            txt += '\n\nTake additional actions before next month.';
            document.getElementById('eventResult').innerHTML = '<pre>' + txt + '</pre>';
            actions = [];
            document.getElementById('logContent').textContent = 'No actions taken.';
            document.getElementById('freeActionScreen').classList.remove('hidden');
            updateDisplay();
            updateSelector();
        }

        function log(msg) { actions.push(msg); document.getElementById('logContent').textContent = actions.join('\n'); }

        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            ['opsTab', 'growthTab', 'financeTab', 'marketingTab', 'empireTab'].forEach(id =>
                document.getElementById(id).classList.add('hidden')
            );
            document.getElementById(tab + 'Tab').classList.remove('hidden');
        }

        function quickLoan(amt, mo, mos) {
            const co = getCo(), debt = calcDebt(co);
            let max = 20;
            if (amt >= 10000) max = 30;
            if (amt >= 30000) max = 50;
            if (debt >= max) return log(`‚úó Debt too high (${debt}%)`);
            if (amt >= 30000 && co.rep < 50) return log('‚úó Rep too low');
            co.cash += amt;
            co.loans.push({ monthly: mo, months: mos });
            co.exp += mo;
            log(`‚úì Loan: +$${amt.toLocaleString()} (-$${mo}/mo)`);
            updateDisplay();
            updateSelector();
        }

        function act(type) {
            const co = getCo();
            const ops = {
                hire: () => {
                    if (co.cash < 2500) return log('‚úó Need $2500');
                    co.cash -= 2500; co.emp++; co.qual += 2;
                    log('‚úì Hired (+1 emp, Qual +2)');
                },
                fire: () => {
                    if (co.emp <= 1) return log('‚úó Cannot fire self');
                    co.emp--; co.cash += 800; co.rep -= 8; co.morale -= 15; co.qual -= 5;
                    log('‚úì Fired (+$800, Rep -8, Morale -15, Qual -5)');
                },
                train: () => {
                    if (co.cash < 1500) return log('‚úó Need $1500');
                    co.cash -= 1500; co.qual += 8; co.morale += 10;
                    log('‚úì Training (Qual +8, Morale +10)');
                },
                wages: () => {
                    const cost = co.emp * 300;
                    if (co.cash < cost) return log('‚úó Need $' + cost);
                    co.cash -= cost; co.exp += co.emp * 30; co.morale += 20;
                    log(`‚úì Wages +10% (Morale +20, +$${co.emp * 30}/mo)`);
                },
                workplace: () => {
                    if (co.cash < 3000) return log('‚úó Need $3000');
                    co.cash -= 3000; co.morale += 15; co.rep += 6;
                    log('‚úì Workplace (Morale +15, Rep +6)');
                },
                automate: () => {
                    if (co.cash < 5000) return log('‚úó Need $5000');
                    co.cash -= 5000; co.qual += 10; co.exp += 200;
                    log('‚úì Automated (Qual +10, +$200/mo)');
                },
                quality: () => {
                    if (co.cash < 2000) return log('‚úó Need $2000');
                    co.cash -= 2000; co.qual += 12; co.revBoost += 500;
                    log('‚úì QC (Qual +12, +$500/mo temp)');
                },
                cs: () => {
                    if (co.cash < 1800) return log('‚úó Need $1800');
                    co.cash -= 1800;
                    const gain = Math.floor(30 / (1 + co.cust * 0.005));
                    co.cust += gain; co.rep += 8;
                    log(`‚úì CS (+${gain} cust, Rep +8)`);
                },
                maintain: () => {
                    if (co.cash < 1000) return log('‚úó Need $1000');
                    co.cash -= 1000; co.qual += 5;
                    log('‚úì Maintenance (Qual +5)');
                },
                expand: () => {
                    if (co.cash < 15000) return log('‚úó Need $15000');
                    co.cash -= 15000; co.rev += 1000; co.cust += 100; co.emp += 2;
                    log('‚úì New location (+100 cust, +$1000/mo, +2 emp)');
                },
                product: () => {
                    if (co.cash < 8000) return log('‚úó Need $8000');
                    co.cash -= 8000; co.rev += 400; co.cust += 40; co.qual += 10;
                    log('‚úì New product (+40 cust, Qual +10, +$400/mo)');
                },
                partner: () => {
                    if (co.cash < 4000) return log('‚úó Need $4000');
                    co.cash -= 4000; co.cust += 60; co.rep += 10; co.revBoost += 1000;
                    log('‚úì Partnership (+60 cust, Rep +10, +$1000/mo)');
                },
                franchise: () => {
                    if (co.cash < 12000) return log('‚úó Need $12000');
                    co.cash -= 12000; co.rev += 1800; co.cust += 70; co.rep += 12;
                    log('‚úì Franchise (+70 cust, +$1800/mo)');
                },
                acquire: () => {
                    if (co.cash < 25000) return log('‚úó Need $25000');
                    co.cash -= 25000; co.cust += 80; co.emp += 3; co.rev += 2000;
                    log('‚úì Acquisition (+80 cust, +3 emp, +$2000/mo)');
                },
                intl: () => {
                    if (co.cash < 35000) return log('‚úó Need $35000');
                    co.cash -= 35000; co.cust += 150; co.rev += 3500; co.emp += 5; co.rep += 20;
                    log('‚úì International (+150 cust, +$3500/mo)');
                },
                investor: () => {
                    if (co.rep < 40) return log('‚úó Rep too low');
                    co.cash += 20000; co.exp += Math.floor(co.rev * 0.08);
                    log('‚úì Investor (+$20K, 8% rev share)');
                },
                cut: () => {
                    if (co.emp <= 2) return log('‚úó Not enough emp');
                    co.emp -= 2; co.cash += 1500; co.rep -= 15; co.morale -= 25; co.qual -= 10;
                    log('‚úì Cuts (-2 emp, +$1500, severe impact)');
                },
                stocks: () => {
                    if (co.cash < 5000) return log('‚úó Need $5000');
                    co.cash -= 5000;
                    const gain = Math.random() > 0.5 ? Math.floor(Math.random() * 3000 + 1000) : -Math.floor(Math.random() * 2000);
                    co.cash += gain;
                    log(`‚úì Stocks ${gain > 0 ? 'gained' : 'lost'} $${Math.abs(gain)}`);
                },
                realestate: () => {
                    if (co.cash < 18000) return log('‚úó Need $18000');
                    co.cash -= 18000; co.rev += 1200;
                    log('‚úì Real estate (+$1200/mo)');
                },
                refinance: () => {
                    if (co.loans.length === 0) return log('‚úó No loans');
                    if (co.cash < 3000) return log('‚úó Need $3000');
                    co.cash -= 3000;
                    co.loans.forEach(l => { const r = Math.floor(l.monthly * 0.25); co.exp -= r; l.monthly -= r; });
                    log('‚úì Refinanced (25% reduction)');
                },
                payoff: () => {
                    if (co.loans.length === 0) return log('‚úó No loans');
                    const loan = co.loans[0];
                    const owed = loan.monthly * loan.months;
                    if (co.cash < owed) return log(`‚úó Need $${owed.toLocaleString()}`);
                    co.cash -= owed; co.exp -= loan.monthly; co.loans.shift();
                    log(`‚úì Paid off (-$${owed.toLocaleString()})`);
                },
                marketing: () => {
                    if (co.cash < 3500) return log('‚úó Need $3500');
                    co.cash -= 3500;
                    const gain = Math.floor(50 / (1 + co.cust * 0.003));
                    co.revBoost += 2500; co.cust += gain; co.rep += 7;
                    log(`‚úì Marketing (+${gain} cust, +$2500/mo temp)`);
                },
                social: () => {
                    if (co.cash < 1200) return log('‚úó Need $1200');
                    co.cash -= 1200; co.cust += 25;
                    log('‚úì Social media (+25 cust)');
                },
                pr: () => {
                    if (co.cash < 2500) return log('‚úó Need $2500');
                    co.cash -= 2500; co.rep += 15; co.cust += 20;
                    log('‚úì PR (Rep +15, +20 cust)');
                },
                rebrand: () => {
                    if (co.cash < 5000) return log('‚úó Need $5000');
                    co.cash -= 5000; co.rep += 10; co.cust += 35;
                    log('‚úì Rebrand (Rep +10, +35 cust)');
                },
                influencer: () => {
                    if (co.cash < 4000) return log('‚úó Need $4000');
                    co.cash -= 4000; co.cust += 60; co.rep += 12;
                    log('‚úì Influencer (+60 cust, Rep +12)');
                },
                seo: () => {
                    if (co.cash < 3000) return log('‚úó Need $3000');
                    co.cash -= 3000; co.cust += 45; co.rev += 800;
                    log('‚úì SEO (+45 cust, +$800/mo)');
                },
                newco: () => {
                    const total = companies.reduce((s, c) => s + c.cash, 0);
                    if (total < 20000) return log('‚úó Need $20K total');
                    const name = prompt('Company name:');
                    if (!name) return;
                    const types = Object.keys(bizTypes);
                    const choice = prompt('Type:\n' + types.map((t, i) => `${i + 1}. ${bizTypes[t].name}`).join('\n'));
                    const type = types[parseInt(choice) - 1];
                    if (!type) return alert('Invalid');
                    getCo().cash -= 20000;
                    companies.push(createCo(type, name, false));
                    activeIdx = companies.length - 1;
                    updateSelector();
                    updateDisplay();
                    log(`‚úì Started ${name}`);
                },
                transfer: () => {
                    if (companies.length < 2) return log('‚úó Need 2+ companies');
                    const amt = parseInt(prompt('Amount:'));
                    if (!amt || amt <= 0 || co.cash < amt) return;
                    const idx = parseInt(prompt('To:\n' + companies.map((c, i) => i !== activeIdx ? `${i + 1}. ${c.name}` : '').filter(Boolean).join('\n'))) - 1;
                    if (idx < 0 || idx >= companies.length || idx === activeIdx) return;
                    co.cash -= amt;
                    companies[idx].cash += amt;
                    log(`‚úì Transferred $${amt.toLocaleString()}`);
                    updateSelector();
                },
                cross: () => {
                    if (companies.length < 2) return log('‚úó Need 2+ companies');
                    if (co.cash < 2000) return log('‚úó Need $2000');
                    co.cash -= 2000;
                    companies.forEach(c => { c.cust += 15; c.rep += 3; });
                    log('‚úì Cross-promo (+15 cust, +3 rep all)');
                    updateSelector();
                },
                merge: () => {
                    if (companies.length < 2) return log('‚úó Need 2+ companies');
                    const idx = parseInt(prompt('Merge with:\n' + companies.map((c, i) => i !== activeIdx ? `${i + 1}. ${c.name}` : '').filter(Boolean).join('\n'))) - 1;
                    if (idx < 0 || idx >= companies.length || idx === activeIdx) return;
                    const target = companies[idx];
                    co.cash += target.cash; co.emp += target.emp; co.cust += target.cust;
                    co.rev += target.rev; co.exp += target.exp;
                    co.qual = Math.floor((co.qual + target.qual) / 2);
                    companies.splice(idx, 1);
                    if (idx < activeIdx) activeIdx--;
                    log(`‚úì Merged ${target.name}`);
                    updateSelector();
                },
                sell: () => {
                    if (companies.length <= 1) return log('‚úó Cannot sell only company');
                    const val = co.cash + (calcRev(co) - calcExp(co)) * 12;
                    if (confirm(`Sell ${co.name} for $${val.toLocaleString()}?`)) {
                        companies.splice(activeIdx, 1);
                        activeIdx = Math.max(0, activeIdx - 1);
                        companies[activeIdx].cash += val;
                        updateSelector();
                        updateDisplay();
                        alert(`Sold for $${val.toLocaleString()}`);
                    }
                }
            };
            if (ops[type]) { ops[type](); updateDisplay(); updateSelector(); }
        }

        function nextMonth() {
            hideAll();
            getCo().month++;
            showReport();
        }

        function showVictory() {
            hideAll();
            const co = getCo();
            document.getElementById('victoryContent').innerHTML = 
                `<pre>${co.name} reached $100K+ with 70+ rep!\n\nMonths: ${co.month}\nCash: $${co.cash.toLocaleString()}\n\nContinue building your empire!</pre>`;
            document.getElementById('victoryScreen').classList.remove('hidden');
        }

        function continueAfterVictory() { hideAll(); showReport(); }

        function showGameOver() {
            hideAll();
            const co = getCo();
            document.getElementById('gameOverContent').innerHTML = 
                `<pre>${co.name} went bankrupt.\n\nSurvived: ${co.month} months\nCash: $${co.cash.toLocaleString()}\n\n${companies.length > 1 ? 'You have ' + (companies.length - 1) + ' other company/companies.' : ''}</pre>`;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        function closeCompany() {
            if (companies.length > 1) {
                companies.splice(activeIdx, 1);
                activeIdx = Math.max(0, activeIdx - 1);
                updateSelector();
                hideAll();
                showReport();
            } else {
                resetGame();
            }
        }

        function resetGame() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            companies = [];
            activeIdx = 0;
            nextId = 1;
            selectedBiz = null;
            document.querySelectorAll('.business-type').forEach(el => el.classList.remove('selected'));
        }

        selectBusiness('tech');
    </script>
</body>
</html>
