<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Empire Simulator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.4;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            border: 2px solid #0f0;
            padding: 20px;
            background: #000;
        }

        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 15px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            z-index: 999;
        }

        .settings-btn:hover {
            background: #0f0;
            color: #000;
        }

        .settings-panel {
            position: fixed;
            top: 60px;
            right: 20px;
            background: #000;
            border: 2px solid #0f0;
            padding: 20px;
            z-index: 1000;
            min-width: 300px;
        }

        .settings-panel h3 {
            margin-bottom: 15px;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
        }

        .company-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 10px;
            border: 1px solid #0f0;
        }

        .company-tab {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 15px;
            cursor: pointer;
            white-space: nowrap;
            min-width: 150px;
            text-align: center;
        }

        .company-tab:hover {
            background: #003300;
        }

        .company-tab.active {
            background: #0f0;
            color: #000;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
            border: 2px solid #0f0;
            padding: 10px;
        }

        .stat-item {
            padding: 5px;
            border-bottom: 1px solid #003300;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .event-container {
            border: 2px solid #0f0;
            padding: 20px;
            margin-bottom: 20px;
        }

        .event-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #0f0;
        }

        .event-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .choices {
            display: grid;
            gap: 10px;
        }

        .choice-button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 15px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            text-align: left;
        }

        .choice-button:hover:not(:disabled) {
            background: #0f0;
            color: #000;
        }

        .choice-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .action-button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 12px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            text-align: center;
        }

        .action-button:hover:not(:disabled) {
            background: #0f0;
            color: #000;
        }

        .action-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 12px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        button:hover {
            background: #0f0;
            color: #000;
        }

        .title {
            text-align: center;
            font-size: 32px;
            margin-bottom: 20px;
            border-bottom: 2px solid #0f0;
            padding-bottom: 10px;
            letter-spacing: 3px;
        }

        .warning { color: #f00; }
        .success { color: #0ff; }

        .business-type {
            border: 2px solid #0f0;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
        }

        .business-type:hover {
            background: #003300;
        }

        .business-type.selected {
            background: #0f0;
            color: #000;
        }

        .hidden { display: none !important; }

        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-button {
            flex: 1;
            padding: 10px;
            font-size: 12px;
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
        }

        .tab-button.active {
            background: #0f0;
            color: #000;
        }

        .action-log {
            background: #000;
            border: 1px solid #0f0;
            padding: 15px;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 11px;
        }

        .loan-section {
            border: 2px solid #0f0;
            padding: 15px;
            margin-bottom: 20px;
        }

        .loan-section h3 {
            margin-bottom: 10px;
        }

        .loan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
        }

        .debt-warning {
            background: #000;
            border: 2px solid #f00;
            padding: 15px;
            margin-bottom: 20px;
            color: #f00;
        }

        .portfolio-summary {
            border: 2px solid #0f0;
            padding: 15px;
            margin-bottom: 20px;
        }

        .portfolio-summary h3 {
            margin-bottom: 10px;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
        }

        input, select {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px;
            font-family: 'Courier New', monospace;
            width: 100%;
            margin: 10px 0;
            font-size: 14px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #0ff;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: #000;
            padding: 30px;
            border: 3px solid #0f0;
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 15px;
            border-bottom: 1px solid #0f0;
            padding-bottom: 10px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
        }

        @media (max-width: 768px) {
            .actions { grid-template-columns: 1fr; }
            .stats { grid-template-columns: 1fr 1fr; }
            .loan-grid { grid-template-columns: 1fr; }
        }

        .report-box {
            border: 2px solid #0f0;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-box {
            border: 2px solid #0f0;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 100px;
        }

        pre {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <button class="settings-btn" onclick="toggleSettings()">SETTINGS</button>
    
    <div id="settingsPanel" class="settings-panel hidden">
        <h3>SETTINGS</h3>
        <label style="display: block; margin: 15px 0;">
            Game Speed:
            <select id="speedSelect">
                <option value="slow">Slow</option>
                <option value="normal" selected>Normal</option>
                <option value="fast">Fast</option>
            </select>
        </label>
        <button onclick="toggleSettings()" style="width: 100%;">CLOSE</button>
    </div>

    <div id="transferModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-title">TRANSFER FUNDS</div>
            <p style="margin-bottom: 15px;">Move money between companies</p>
            <label>
                FROM: <span id="fromCompanyName"></span><br>
                Available: $<span id="availableCash">0</span>
            </label>
            <label>
                TO:<br>
                <select id="targetCompany"></select>
            </label>
            <label>
                AMOUNT:<br>
                <input type="number" id="transferAmount" placeholder="Enter amount" min="0">
            </label>
            <div class="modal-buttons">
                <button onclick="confirmTransfer()">TRANSFER</button>
                <button onclick="closeTransferModal()">CANCEL</button>
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="title">BUSINESS EMPIRE SIMULATOR</div>
        
        <div id="setupScreen">
            <h2 style="margin-bottom: 20px;">CREATE YOUR BUSINESS</h2>
            <input type="text" id="playerName" placeholder="Your name" value="Alex Smith">
            <input type="text" id="companyName" placeholder="Company name" value="TechCorp">
            
            <h3 style="margin: 30px 0 15px 0; border-bottom: 1px solid #0f0; padding-bottom: 5px;">CHOOSE BUSINESS TYPE</h3>
            
            <div class="business-type" onclick="selectBusiness('tech')">
                <strong>TECH STARTUP</strong><br>
                High growth, volatile market<br>
                Start: $8K | 2 employees | Quality: 40
            </div>
            
            <div class="business-type" onclick="selectBusiness('retail')">
                <strong>RETAIL STORE</strong><br>
                Steady income, inventory focus<br>
                Start: $10K | 3 employees | Quality: 50
            </div>
            
            <div class="business-type" onclick="selectBusiness('restaurant')">
                <strong>RESTAURANT</strong><br>
                High volume, quality critical<br>
                Start: $7K | 4 employees | Quality: 45
            </div>
            
            <div class="business-type" onclick="selectBusiness('consulting')">
                <strong>CONSULTING FIRM</strong><br>
                Reputation dependent, high margins<br>
                Start: $12K | 2 employees | Quality: 60
            </div>
            
            <div class="business-type" onclick="selectBusiness('ecommerce')">
                <strong>E-COMMERCE</strong><br>
                Online sales, scalable<br>
                Start: $9K | 2 employees | Quality: 45
            </div>
            
            <button onclick="startGame()" style="width: 100%; padding: 15px; margin-top: 20px;">START GAME</button>
        </div>

        <div id="gameScreen" class="hidden">
            <div id="portfolioSummary" class="portfolio-summary hidden">
                <h3>PORTFOLIO OVERVIEW</h3>
                <pre id="portfolioContent"></pre>
            </div>

            <div id="debtWarning" class="debt-warning hidden"></div>
            <div id="companySelector" class="company-selector"></div>

            <div class="stats">
                <div class="stat-item">CASH: $<span id="cash">0</span></div>
                <div class="stat-item">MONTH: <span id="month">1</span></div>
                <div class="stat-item">EMPLOYEES: <span id="employees">0</span></div>
                <div class="stat-item">REPUTATION: <span id="reputation">0</span>/100</div>
                <div class="stat-item">CUSTOMERS: <span id="customers">0</span></div>
                <div class="stat-item">QUALITY: <span id="quality">0</span>/100</div>
                <div class="stat-item">REVENUE/MO: $<span id="revenue">0</span></div>
                <div class="stat-item">EXPENSES/MO: $<span id="expenses">0</span></div>
                <div class="stat-item">MORALE: <span id="morale">0</span>/100</div>
                <div class="stat-item">DEBT: <span id="debtCapacity">0</span>%</div>
            </div>

            <div id="monthlyReportScreen" class="hidden">
                <div class="report-box">
                    <h3>MONTHLY REPORT - MONTH <span id="reportMonth"></span></h3>
                    <pre id="reportContent"></pre>
                </div>
                <button onclick="showEvent()" style="width: 100%; padding: 15px;">CONTINUE</button>
            </div>

            <div id="eventScreen" class="hidden">
                <div class="event-container">
                    <div class="event-title" id="eventTitle"></div>
                    <div class="event-description" id="eventDescription"></div>
                    <div class="choices" id="eventChoices"></div>
                </div>
            </div>

            <div id="freeActionScreen" class="hidden">
                <div class="result-box" id="eventResult"></div>
                
                <div class="loan-section">
                    <h3>FINANCING (DEBT: <span id="currentDebt">0</span>%)</h3>
                    <div class="loan-grid">
                        <button class="action-button" onclick="quickLoan(5000, 250, 36)">
                            MICRO LOAN<br>+$5,000<br>-$250/mo x36<br>Max: 20% debt
                        </button>
                        <button class="action-button" onclick="quickLoan(10000, 500, 36)">
                            SMALL LOAN<br>+$10,000<br>-$500/mo x36<br>Max: 30% debt
                        </button>
                        <button class="action-button" onclick="quickLoan(30000, 1500, 36)">
                            BUSINESS LOAN<br>+$30,000<br>-$1,500/mo x36<br>Max: 50% | Rep: 50+
                        </button>
                        <button class="action-button" onclick="quickLoan(75000, 3500, 36)">
                            CREDIT LINE<br>+$75,000<br>-$3,500/mo x36<br>Max: 65% | Rep: 70+
                        </button>
                    </div>
                </div>

                <div class="action-log">
                    <strong>ACTION LOG:</strong>
                    <div id="logContent" style="margin-top: 5px;">No actions taken this month.</div>
                </div>

                <div class="tab-buttons">
                    <button class="tab-button active" onclick="showTab('ops')">OPERATIONS</button>
                    <button class="tab-button" onclick="showTab('growth')">GROWTH</button>
                    <button class="tab-button" onclick="showTab('finance')">FINANCE</button>
                    <button class="tab-button" onclick="showTab('marketing')">MARKETING</button>
                    <button class="tab-button" onclick="showTab('empire')">EMPIRE</button>
                </div>

                <div id="opsTab" class="actions"></div>
                <div id="growthTab" class="actions hidden"></div>
                <div id="financeTab" class="actions hidden"></div>
                <div id="marketingTab" class="actions hidden"></div>
                <div id="empireTab" class="actions hidden"></div>

                <button onclick="nextMonth()" style="width: 100%; padding: 15px; margin-top: 15px;">ADVANCE TO NEXT MONTH</button>
            </div>

            <div id="victoryScreen" class="hidden">
                <div class="result-box" style="text-align: center;">
                    <h2 style="margin-bottom: 20px;">VICTORY!</h2>
                    <pre id="victoryContent"></pre>
                </div>
                <button onclick="continueAfterVictory()" style="width: 100%; padding: 15px; margin-bottom: 10px;">CONTINUE</button>
                <button onclick="resetGame()" style="width: 100%; padding: 15px;">NEW GAME</button>
            </div>

            <div id="gameOverScreen" class="hidden">
                <div class="result-box" style="text-align: center;">
                    <h2 class="warning" style="margin-bottom: 20px;">BANKRUPTCY</h2>
                    <pre id="gameOverContent"></pre>
                </div>
                <button onclick="closeCompany()" style="width: 100%; padding: 15px; margin-bottom: 10px;">CLOSE COMPANY</button>
                <button onclick="resetGame()" style="width: 100%; padding: 15px;">NEW GAME</button>
            </div>
        </div>
    </div>

    <script>
        let selectedBiz = null, currentTab = 'ops', actions = [], companies = [], activeIdx = 0, nextId = 1;
        let gameSpeed = { slow: 1.5, normal: 1, fast: 0.7 };

        const bizTypes = {
            tech: { name: 'Tech Startup', cash: 8000, emp: 2, qual: 40, cust: 30, rep: 35, rev: 2800, exp: 2200 },
            retail: { name: 'Retail Store', cash: 10000, emp: 3, qual: 50, cust: 80, rep: 45, rev: 4000, exp: 2800 },
            restaurant: { name: 'Restaurant', cash: 7000, emp: 4, qual: 45, cust: 60, rep: 40, rev: 4500, exp: 3500 },
            consulting: { name: 'Consulting', cash: 12000, emp: 2, qual: 60, cust: 20, rep: 55, rev: 5500, exp: 2000 },
            ecommerce: { name: 'E-Commerce', cash: 9000, emp: 2, qual: 45, cust: 50, rep: 38, rev: 3200, exp: 2100 }
        };

        const actionDefs = {
            ops: [
                { id: 'hire', label: 'Hire Employee', cost: 2500 },
                { id: 'fire', label: 'Fire Employee', cost: 800, gain: true },
                { id: 'train', label: 'Train Staff', cost: 1500 },
                { id: 'wages', label: 'Raise Wages', cost: 'varies' },
                { id: 'workplace', label: 'Improve Workplace', cost: 3000 },
                { id: 'automate', label: 'Automate', cost: 5000 },
                { id: 'quality', label: 'Quality Control', cost: 2000 },
                { id: 'cs', label: 'Customer Service', cost: 1800 },
                { id: 'maintain', label: 'Maintenance', cost: 1000 }
            ],
            growth: [
                { id: 'expand', label: 'New Location', cost: 15000 },
                { id: 'product', label: 'New Product', cost: 8000 },
                { id: 'partner', label: 'Partnership', cost: 4000 },
                { id: 'franchise', label: 'Franchise', cost: 12000 },
                { id: 'acquire', label: 'Acquire Competitor', cost: 25000 },
                { id: 'intl', label: 'Go International', cost: 35000 }
            ],
            finance: [
                { id: 'investor', label: 'Seek Investor', cost: 'equity' },
                { id: 'cut', label: 'Cut Costs', cost: 'harsh' },
                { id: 'stocks', label: 'Invest Stocks', cost: 5000 },
                { id: 'realestate', label: 'Real Estate', cost: 18000 },
                { id: 'refinance', label: 'Refinance', cost: 3000 },
                { id: 'payoff', label: 'Pay Off Loan', cost: 'varies' }
            ],
            marketing: [
                { id: 'marketing', label: 'Campaign', cost: 3500 },
                { id: 'social', label: 'Social Media', cost: 1200 },
                { id: 'pr', label: 'PR Campaign', cost: 2500 },
                { id: 'rebrand', label: 'Rebrand', cost: 5000 },
                { id: 'influencer', label: 'Influencer', cost: 4000 },
                { id: 'seo', label: 'SEO', cost: 3000 }
            ],
            empire: [
                { id: 'newco', label: 'Start Company', cost: 20000 },
                { id: 'transfer', label: 'Transfer Funds', cost: 'free' },
                { id: 'cross', label: 'Cross-Promote', cost: 2000 },
                { id: 'merge', label: 'Merge', cost: 'free' },
                { id: 'sell', label: 'Sell Company', cost: 'free' }
            ]
        };

        const events = {
            quality: [
                { title: "Quality Complaints", desc: "Multiple customers report quality issues. Social media sentiment turning negative.", choices: [
                    { text: "Refund program + apology (-$800, Rep +8)", cost: 800, effects: { rep: 8, cust: -3 } },
                    { text: "Hire QA team (-$4000, Quality +20)", cost: 4000, effects: { qual: 20, emp: 1 } },
                    { text: "Ignore (Rep -20, Cust -25)", cost: 0, effects: { rep: -20, cust: -25 } }
                ]},
                { title: "Equipment Failure", desc: "Primary production equipment failed during peak season.", choices: [
                    { text: "Emergency repair (-$5000, Quality +8)", cost: 5000, effects: { qual: 8 } },
                    { text: "Standard repair (-$2000, Quality -5)", cost: 2000, effects: { qual: -5, rev: -800 } },
                    { text: "Upgrade equipment (-$12000, Quality +30)", cost: 12000, effects: { qual: 30, exp: -200 } }
                ]}
            ],
            employee: [
                { title: "Talent Poaching", desc: "Star employee received competitor offer - 60% higher salary.", choices: [
                    { text: "Match offer (Expenses +$1800/mo)", cost: 0, effects: { exp: 1800, morale: 10 } },
                    { text: "Counter with equity (Expenses +$900/mo)", cost: 0, effects: { exp: 900, morale: 15 } },
                    { text: "Let go, hire replacement (-$3500, Qual -15)", cost: 3500, effects: { qual: -15, morale: -8 } }
                ]},
                { title: "Morale Crisis", desc: "Employee survey reveals widespread dissatisfaction.", choices: [
                    { text: "Company retreat (-$4500, Morale +30)", cost: 4500, effects: { morale: 30 } },
                    { text: "Raise salaries (Expenses +$2000/mo)", cost: 0, effects: { exp: 2000, morale: 25 } },
                    { text: "Do nothing (Morale -15, lose employee)", cost: 0, effects: { morale: -15, emp: -1 } }
                ]}
            ],
            customer: [
                { title: "Enterprise Client", desc: "Fortune 500 company wants exclusivity deal.", choices: [
                    { text: "Accept + expand (-$10000, Rev +$3500/mo)", cost: 10000, effects: { rev: 3500, emp: 3 } },
                    { text: "Negotiate smaller (-$4000, Rev +$1800/mo)", cost: 4000, effects: { rev: 1800 } },
                    { text: "Decline", cost: 0, effects: {} }
                ]},
                { title: "Viral Publicity", desc: "Influencer praised your business. Orders flooding in.", choices: [
                    { text: "Scale up (-$8000, Cust +100)", cost: 8000, effects: { cust: 100, emp: 3 } },
                    { text: "Moderate expansion (-$4000, Cust +60)", cost: 4000, effects: { cust: 60 } },
                    { text: "Organic growth (Cust +30, Qual +15)", cost: 0, effects: { cust: 30, qual: 15 } }
                ]}
            ],
            market: [
                { title: "Price War", desc: "Well-funded competitor slashed prices by 40%.", choices: [
                    { text: "Match prices (Rev -$2000/mo, Cust +25)", cost: 0, effects: { rev: -2000, cust: 25 } },
                    { text: "Quality focus (-$5000, Qual +30, Rep +20)", cost: 5000, effects: { qual: 30, rep: 20 } },
                    { text: "Do nothing (Cust -40)", cost: 0, effects: { cust: -40 } }
                ]},
                { title: "New Market", desc: "Research reveals underserved segment.", choices: [
                    { text: "Full entry (-$15000, Rev +$3500/mo)", cost: 15000, effects: { rev: 3500, cust: 80 } },
                    { text: "Test pilot (-$6000, Rev +$1500/mo)", cost: 6000, effects: { rev: 1500, cust: 35 } },
                    { text: "Skip", cost: 0, effects: {} }
                ]}
            ]
        };

        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('hidden');
        }

        function selectBusiness(type) {
            document.querySelectorAll('.business-type').forEach(el => el.classList.remove('selected'));
            event.target.closest('.business-type').classList.add('selected');
            selectedBiz = type;
        }

        function createCo(type, name, first = false) {
            const t = bizTypes[type];
            return {
                id: nextId++, name, type, cash: first ? t.cash : 0, month: 1, emp: t.emp, rep: t.rep,
                cust: t.cust, qual: t.qual, morale: 60, rev: t.rev, exp: t.exp, revBoost: 0,
                loans: [], total: { rev: 0, exp: 0 }, used: [], victory: false, prevRev: 0, prevExp: 0
            };
        }

        function getSpeed() {
            return gameSpeed[document.getElementById('speedSelect').value];
        }

        function startGame() {
            const name = document.getElementById('companyName').value || 'TechCorp';
            if (!selectedBiz) return alert('Select business type');
            companies = [createCo(selectedBiz, name, true)];
            activeIdx = 0;
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            updateSelector();
            renderActionButtons();
            updateDisplay();
            showReport();
        }

        function renderActionButtons() {
            Object.keys(actionDefs).forEach(tab => {
                const container = document.getElementById(tab + 'Tab');
                container.innerHTML = '';
                actionDefs[tab].forEach(action => {
                    const btn = document.createElement('button');
                    btn.className = 'action-button';
                    let costText = typeof action.cost === 'number' 
                        ? (action.gain ? `+$${action.cost.toLocaleString()}` : `-$${action.cost.toLocaleString()}`)
                        : action.cost;
                    btn.innerHTML = `${action.label}<br>${costText}`;
                    btn.onclick = () => act(action.id);
                    container.appendChild(btn);
                });
            });
        }

        function updateSelector() {
            const sel = document.getElementById('companySelector');
            sel.innerHTML = '';
            companies.forEach((co, i) => {
                const net = calcRev(co) - calcExp(co);
                const tab = document.createElement('div');
                tab.className = 'company-tab' + (i === activeIdx ? ' active' : '');
                tab.innerHTML = `${co.name}<br>$${co.cash.toLocaleString()}<br>${net >= 0 ? '+' : ''}$${net.toLocaleString()}/mo`;
                tab.onclick = () => switchCo(i);
                sel.appendChild(tab);
            });
            const newTab = document.createElement('div');
            newTab.className = 'company-tab';
            newTab.style.borderStyle = 'dashed';
            newTab.innerHTML = '+ NEW<br>COMPANY';
            newTab.onclick = () => act('newco');
            sel.appendChild(newTab);
            updatePortfolio();
        }

        function updatePortfolio() {
            if (companies.length > 1) {
                const cash = companies.reduce((s, c) => s + c.cash, 0);
                const rev = companies.reduce((s, c) => s + calcRev(c), 0);
                const emp = companies.reduce((s, c) => s + c.emp, 0);
                document.getElementById('portfolioContent').textContent = 
                    `Companies: ${companies.length}\n` +
                    `Total Cash: $${cash.toLocaleString()}\n` +
                    `Combined Revenue: $${rev.toLocaleString()}/mo\n` +
                    `Total Employees: ${emp}`;
                document.getElementById('portfolioSummary').classList.remove('hidden');
            } else {
                document.getElementById('portfolioSummary').classList.add('hidden');
            }
        }

        function switchCo(i) { activeIdx = i; updateSelector(); updateDisplay(); }
        function getCo() { return companies[activeIdx]; }

        function calcRev(co) {
            const speed = getSpeed();
            let r = co.rev + co.emp * 400 / (1 + co.emp * 0.015) + co.cust * 12 / (1 + co.cust * 0.0008) + co.revBoost;
            r *= (co.qual / 100 + 0.6) * (co.rep / 100 + 0.6) * (co.morale / 100 * 0.25 + 0.85);
            return Math.max(0, Math.floor(r * (0.9 + Math.random() * 0.2) * speed));
        }

        function calcExp(co) {
            const speed = getSpeed();
            let e = co.exp + co.emp * 450 * (1 + co.emp * 0.008);
            co.loans.forEach(l => e += l.monthly);
            return Math.max(0, Math.floor(e * (co.morale < 40 ? 1.12 : 1) * speed));
        }

        function calcDebt(co) {
            const total = co.loans.reduce((s, l) => s + l.monthly, 0);
            return Math.floor((total / Math.max(calcRev(co), 1)) * 100);
        }

        function updateDisplay() {
            const co = getCo();
            document.getElementById('cash').textContent = co.cash.toLocaleString();
            document.getElementById('month').textContent = co.month;
            document.getElementById('employees').textContent = co.emp;
            document.getElementById('reputation').textContent = Math.max(0, Math.min(100, co.rep));
            document.getElementById('customers').textContent = co.cust;
            document.getElementById('quality').textContent = Math.max(0, Math.min(100, co.qual));
            document.getElementById('morale').textContent = Math.max(0, Math.min(100, co.morale));
            document.getElementById('revenue').textContent = calcRev(co).toLocaleString();
            document.getElementById('expenses').textContent = calcExp(co).toLocaleString();
            const debt = calcDebt(co);
            document.getElementById('debtCapacity').textContent = debt;
            document.getElementById('currentDebt').textContent = debt;
            if (debt > 60) {
                document.getElementById('debtWarning').textContent = `WARNING: HIGH DEBT ${debt}%`;
                document.getElementById('debtWarning').classList.remove('hidden');
            } else {
                document.getElementById('debtWarning').classList.add('hidden');
            }
        }

        function hideAll() {
            ['monthlyReportScreen', 'eventScreen', 'freeActionScreen', 'victoryScreen', 'gameOverScreen'].forEach(id =>
                document.getElementById(id).classList.add('hidden')
            );
        }

        function showReport() {
            hideAll();
            const co = getCo();
            const rev = calcRev(co), exp = calcExp(co), net = rev - exp;
            
            co.prevRev = rev;
            co.prevExp = exp;
            co.cash += net;
            co.total.rev += rev;
            co.total.exp += exp;
            
            co.loans = co.loans.filter(l => { l.months--; if (l.months <= 0) co.exp -= l.monthly; return l.months > 0; });
            
            const speed = getSpeed();
            co.qual = Math.max(0, co.qual - (2 * speed));
            co.morale = Math.max(0, co.morale - (1.5 * speed));
            co.cust = Math.max(0, Math.floor(co.cust * (0.98 - (speed - 1) * 0.01)));
            co.revBoost = Math.floor(co.revBoost * 0.7);
            
            if (co.qual > 70) co.rep = Math.min(100, co.rep + 1);
            
            document.getElementById('reportMonth').textContent = co.month;
            document.getElementById('reportContent').textContent = 
                `${co.name}\n\n` +
                `Revenue: +$${rev.toLocaleString()}\n` +
                `Expenses: -$${exp.toLocaleString()}\n` +
                `Net Income: ${net >= 0 ? '+' : ''}$${net.toLocaleString()}\n\n` +
                `Cash Balance: $${co.cash.toLocaleString()}\n` +
                (co.loans.length > 0 ? `Active Loans: ${co.loans.length} (${calcDebt(co)}% debt)\n` : '') +
                `\nQuality -${(2 * speed).toFixed(1)}\n` +
                `Morale -${(1.5 * speed).toFixed(1)}\n` +
                `Customer retention: ${(98 - (speed - 1) * 1).toFixed(0)}%`;
            
            document.getElementById('monthlyReportScreen').classList.remove('hidden');
            updateDisplay();
            updateSelector();
            
            if (co.cash >= 150000 && co.rep >= 75 && !co.victory) {
                co.victory = true;
                showVictory();
            } else if (co.cash < -20000) showGameOver();
        }

        function showEvent() {
            hideAll();
            const cats = Object.keys(events);
            const cat = cats[Math.floor(Math.random() * cats.length)];
            const evts = events[cat];
            const evt = evts[Math.floor(Math.random() * evts.length)];
            
            document.getElementById('eventTitle').textContent = evt.title;
            document.getElementById('eventDescription').textContent = evt.desc;
            
            const container = document.getElementById('eventChoices');
            container.innerHTML = '';
            evt.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-button';
                btn.onclick = () => handleChoice(choice);
                btn.disabled = getCo().cash < choice.cost;
                btn.textContent = choice.text + (getCo().cash < choice.cost && choice.cost > 0 ? 
                    ` [Need $${choice.cost.toLocaleString()}]` : '');
                container.appendChild(btn);
            });
            document.getElementById('eventScreen').classList.remove('hidden');
        }

        function handleChoice(choice) {
            hideAll();
            const co = getCo();
            co.cash -= choice.cost;
            
            let txt = `DECISION: ${choice.text}\n\nEFFECTS:\n`;
            if (choice.cost !== 0) txt += `Cash: ${choice.cost > 0 ? '-' : '+'}$${Math.abs(choice.cost).toLocaleString()}\n`;
            
            const e = choice.effects;
            if (e.rep) { co.rep += e.rep; txt += `Reputation: ${e.rep > 0 ? '+' : ''}${e.rep}\n`; }
            if (e.cust) { co.cust += e.cust; txt += `Customers: ${e.cust > 0 ? '+' : ''}${e.cust}\n`; }
            if (e.qual) { co.qual += e.qual; txt += `Quality: ${e.qual > 0 ? '+' : ''}${e.qual}\n`; }
            if (e.morale) { co.morale += e.morale; txt += `Morale: ${e.morale > 0 ? '+' : ''}${e.morale}\n`; }
            if (e.emp) { co.emp += e.emp; txt += `Employees: ${e.emp > 0 ? '+' : ''}${e.emp}\n`; }
            if (e.rev) { co.rev += e.rev; txt += `Base Revenue: ${e.rev > 0 ? '+' : ''}$${Math.abs(e.rev)}/mo\n`; }
            if (e.exp) { co.exp += e.exp; txt += `Base Expenses: ${e.exp > 0 ? '+' : ''}$${Math.abs(e.exp)}/mo\n`; }
            
            txt += '\nTake additional actions before next month.';
            
            co.rep = Math.max(0, Math.min(100, co.rep));
            co.qual = Math.max(0, Math.min(100, co.qual));
            co.morale = Math.max(0, Math.min(100, co.morale));
            co.cust = Math.max(0, co.cust);
            co.emp = Math.max(1, co.emp);
            
            document.getElementById('eventResult').innerHTML = '<pre>' + txt + '</pre>';
            actions = [];
            document.getElementById('logContent').textContent = 'No actions taken this month.';
            document.getElementById('freeActionScreen').classList.remove('hidden');
            updateDisplay();
            updateSelector();
        }

        function log(msg) {
            actions.push(msg);
            document.getElementById('logContent').innerHTML = actions.join('<br>');
        }

        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            ['opsTab', 'growthTab', 'financeTab', 'marketingTab', 'empireTab'].forEach(id =>
                document.getElementById(id).classList.add('hidden')
            );
            document.getElementById(tab + 'Tab').classList.remove('hidden');
        }

        function quickLoan(amt, mo, mos) {
            const co = getCo(), debt = calcDebt(co);
            let max = 20;
            if (amt >= 10000) max = 30;
            if (amt >= 30000) max = 50;
            if (amt >= 75000) max = 65;
            if (debt >= max) return log(`X Debt too high (${debt}%)`);
            if (amt >= 30000 && co.rep < 50) return log('X Reputation too low (need 50+)');
            if (amt >= 75000 && co.rep < 70) return log('X Reputation too low (need 70+)');
            co.cash += amt;
            co.loans.push({ monthly: mo, months: mos });
            co.exp += mo;
            log(`+ Loan: +$${amt.toLocaleString()} (-$${mo}/mo x${mos})`);
            updateDisplay();
            updateSelector();
        }

        function openTransferModal() {
            if (companies.length < 2) return log('X Need 2+ companies');
            const co = getCo();
            document.getElementById('fromCompanyName').textContent = co.name;
            document.getElementById('availableCash').textContent = co.cash.toLocaleString();
            
            const select = document.getElementById('targetCompany');
            select.innerHTML = companies
                .map((c, i) => i !== activeIdx ? `<option value="${i}">${c.name} ($${c.cash.toLocaleString()})</option>` : '')
                .filter(Boolean)
                .join('');
            
            document.getElementById('transferModal').classList.remove('hidden');
        }

        function closeTransferModal() {
            document.getElementById('transferModal').classList.add('hidden');
        }

        function confirmTransfer() {
            const co = getCo();
            const amt = parseInt(document.getElementById('transferAmount').value);
            const targetIdx = parseInt(document.getElementById('targetCompany').value);
            
            if (!amt || amt <= 0) return alert('Enter valid amount');
            if (co.cash < amt) return alert('Insufficient funds');
            
            co.cash -= amt;
            companies[targetIdx].cash += amt;
            log(`+ Transfer: $${amt.toLocaleString()} to ${companies[targetIdx].name}`);
            closeTransferModal();
            updateDisplay();
            updateSelector();
        }

        function act(type) {
            const co = getCo();
            const ops = {
                hire: () => {
                    if (co.cash < 2500) return log('X Need $2,500');
                    co.cash -= 2500; co.emp++; co.qual += 3;
                    log('+ Hired employee (+1, Qual +3)');
                },
                fire: () => {
                    if (co.emp <= 1) return log('X Cannot fire self');
                    co.emp--; co.cash += 800; co.rep -= 8; co.morale -= 15; co.qual -= 5;
                    log('+ Fired employee (+$800, Rep -8)');
                },
                train: () => {
                    if (co.cash < 1500) return log('X Need $1,500');
                    co.cash -= 1500; co.qual += 10; co.morale += 12;
                    log('+ Training (Qual +10, Morale +12)');
                },
                wages: () => {
                    const cost = co.emp * 300;
                    if (co.cash < cost) return log(`X Need $${cost.toLocaleString()}`);
                    co.cash -= cost; co.exp += co.emp * 30; co.morale += 20; co.rep += 5;
                    log(`+ Wages raised (Morale +20, +$${co.emp * 30}/mo exp)`);
                },
                workplace: () => {
                    if (co.cash < 3000) return log('X Need $3,000');
                    co.cash -= 3000; co.morale += 18; co.rep += 8;
                    log('+ Workplace improved (Morale +18)');
                },
                automate: () => {
                    if (co.cash < 5000) return log('X Need $5,000');
                    co.cash -= 5000; co.qual += 12; co.exp += 200;
                    log('+ Automated (Qual +12, +$200/mo)');
                },
                quality: () => {
                    if (co.cash < 2000) return log('X Need $2,000');
                    co.cash -= 2000; co.qual += 15; co.revBoost += 400;
                    log('+ QC (Qual +15, +$400/mo temp)');
                },
                cs: () => {
                    if (co.cash < 1800) return log('X Need $1,800');
                    co.cash -= 1800;
                    const gain = Math.floor(25 / (1 + co.cust * 0.004));
                    co.cust += gain; co.rep += 10;
                    log(`+ CS (+${gain} cust, Rep +10)`);
                },
                maintain: () => {
                    if (co.cash < 1000) return log('X Need $1,000');
                    co.cash -= 1000; co.qual += 6;
                    log('+ Maintenance (Qual +6)');
                },
                expand: () => {
                    if (co.cash < 15000) return log('X Need $15,000');
                    co.cash -= 15000; co.rev += 1200; co.cust += 80; co.emp += 2;
                    log('+ New location (+80 cust, +$1200/mo)');
                },
                product: () => {
                    if (co.cash < 8000) return log('X Need $8,000');
                    co.cash -= 8000; co.rev += 600; co.cust += 45; co.qual += 12;
                    log('+ New product (+45 cust, +$600/mo)');
                },
                partner: () => {
                    if (co.cash < 4000) return log('X Need $4,000');
                    co.cash -= 4000; co.cust += 50; co.rep += 12; co.revBoost += 800;
                    log('+ Partnership (+50 cust, +$800/mo temp)');
                },
                franchise: () => {
                    if (co.cash < 12000) return log('X Need $12,000');
                    co.cash -= 12000; co.rev += 1500; co.cust += 60; co.rep += 15;
                    log('+ Franchise (+60 cust, +$1500/mo)');
                },
                acquire: () => {
                    if (co.cash < 25000) return log('X Need $25,000');
                    co.cash -= 25000; co.cust += 75; co.emp += 3; co.rev += 1800;
                    log('+ Acquisition (+75 cust, +$1800/mo)');
                },
                intl: () => {
                    if (co.cash < 35000) return log('X Need $35,000');
                    co.cash -= 35000; co.cust += 120; co.rev += 3000; co.emp += 5; co.rep += 20;
                    log('+ International (+120 cust, +$3000/mo)');
                },
                investor: () => {
                    if (co.rep < 40) return log('X Reputation too low');
                    co.cash += 20000; co.exp += Math.floor(co.rev * 0.08);
                    log('+ Investor (+$20K, 8% rev share)');
                },
                cut: () => {
                    if (co.emp <= 2) return log('X Not enough employees');
                    co.emp -= 2; co.cash += 1500; co.rep -= 15; co.morale -= 25; co.qual -= 10;
                    log('+ Emergency cuts (-2 emp, +$1500)');
                },
                stocks: () => {
                    if (co.cash < 5000) return log('X Need $5,000');
                    co.cash -= 5000;
                    const gain = Math.random() > 0.5 ? Math.floor(Math.random() * 3000 + 1000) : -Math.floor(Math.random() * 2000);
                    co.cash += gain;
                    log(`+ Stocks ${gain > 0 ? 'gained' : 'lost'} $${Math.abs(gain).toLocaleString()}`);
                },
                realestate: () => {
                    if (co.cash < 18000) return log('X Need $18,000');
                    co.cash -= 18000; co.rev += 1000;
                    log('+ Real estate (+$1000/mo)');
                },
                refinance: () => {
                    if (co.loans.length === 0) return log('X No loans');
                    if (co.cash < 3000) return log('X Need $3,000');
                    co.cash -= 3000;
                    co.loans.forEach(l => { const r = Math.floor(l.monthly * 0.25); co.exp -= r; l.monthly -= r; });
                    log('+ Refinanced (25% reduction)');
                },
                payoff: () => {
                    if (co.loans.length === 0) return log('X No loans');
                    const loan = co.loans[0];
                    const owed = loan.monthly * loan.months;
                    if (co.cash < owed) return log(`X Need $${owed.toLocaleString()}`);
                    co.cash -= owed; co.exp -= loan.monthly; co.loans.shift();
                    log(`+ Paid off (-$${owed.toLocaleString()})`);
                },
                marketing: () => {
                    if (co.cash < 3500) return log('X Need $3,500');
                    co.cash -= 3500;
                    const gain = Math.floor(40 / (1 + co.cust * 0.002));
                    co.revBoost += 2000; co.cust += gain; co.rep += 10;
                    log(`+ Campaign (+${gain} cust, +$2000/mo temp)`);
                },
                social: () => {
                    if (co.cash < 1200) return log('X Need $1,200');
                    co.cash -= 1200; co.cust += 20;
                    log('+ Social media (+20 cust)');
                },
                pr: () => {
                    if (co.cash < 2500) return log('X Need $2,500');
                    co.cash -= 2500; co.rep += 18; co.cust += 25;
                    log('+ PR (Rep +18, +25 cust)');
                },
                rebrand: () => {
                    if (co.cash < 5000) return log('X Need $5,000');
                    co.cash -= 5000; co.rep += 15; co.cust += 40;
                    log('+ Rebrand (Rep +15, +40 cust)');
                },
                influencer: () => {
                    if (co.cash < 4000) return log('X Need $4,000');
                    co.cash -= 4000; co.cust += 55; co.rep += 15;
                    log('+ Influencer (+55 cust, Rep +15)');
                },
                seo: () => {
                    if (co.cash < 3000) return log('X Need $3,000');
                    co.cash -= 3000; co.cust += 35; co.rev += 600;
                    log('+ SEO (+35 cust, +$600/mo)');
                },
                newco: () => {
                    const total = companies.reduce((s, c) => s + c.cash, 0);
                    if (total < 20000) return log('X Need $20K total');
                    const name = prompt('Company name:');
                    if (!name) return;
                    const types = Object.keys(bizTypes);
                    const choice = prompt('Type:\n' + types.map((t, i) => `${i + 1}. ${bizTypes[t].name}`).join('\n'));
                    const type = types[parseInt(choice) - 1];
                    if (!type) return alert('Invalid');
                    getCo().cash -= 20000;
                    companies.push(createCo(type, name, false));
                    activeIdx = companies.length - 1;
                    updateSelector();
                    updateDisplay();
                    log(`+ Started ${name}`);
                },
                transfer: () => { openTransferModal(); },
                cross: () => {
                    if (companies.length < 2) return log('X Need 2+ companies');
                    if (co.cash < 2000) return log('X Need $2,000');
                    co.cash -= 2000;
                    companies.forEach(c => { c.cust += 12; c.rep += 4; });
                    log('+ Cross-promo (+12 cust all)');
                    updateSelector();
                },
                merge: () => {
                    if (companies.length < 2) return log('X Need 2+ companies');
                    const idx = parseInt(prompt('Merge with:\n' + companies.map((c, i) => 
                        i !== activeIdx ? `${i + 1}. ${c.name}` : ''
                    ).filter(Boolean).join('\n'))) - 1;
                    if (idx < 0 || idx >= companies.length || idx === activeIdx) return;
                    const target = companies[idx];
                    co.cash += target.cash; co.emp += target.emp; co.cust += target.cust;
                    co.rev += target.rev; co.exp += target.exp;
                    co.qual = Math.floor((co.qual + target.qual) / 2);
                    companies.splice(idx, 1);
                    if (idx < activeIdx) activeIdx--;
                    log(`+ Merged ${target.name}`);
                    updateSelector();
                },
                sell: () => {
                    if (companies.length <= 1) return log('X Cannot sell only company');
                    const val = co.cash + (calcRev(co) - calcExp(co)) * 15;
                    if (confirm(`Sell ${co.name} for $${val.toLocaleString()}?`)) {
                        companies.splice(activeIdx, 1);
                        activeIdx = Math.max(0, activeIdx - 1);
                        companies[activeIdx].cash += val;
                        updateSelector();
                        updateDisplay();
                        log(`+ Sold for $${val.toLocaleString()}`);
                    }
                }
            };
            if (ops[type]) { ops[type](); updateDisplay(); updateSelector(); }
        }

        function nextMonth() {
            hideAll();
            getCo().month++;
            showReport();
        }

        function showVictory() {
            hideAll();
            const co = getCo();
            document.getElementById('victoryContent').textContent = 
                `${co.name} reached $150,000+ with 75+ reputation!\n\n` +
                `Time: ${co.month} months\n` +
                `Cash: $${co.cash.toLocaleString()}\n` +
                `Employees: ${co.emp}\n` +
                `Customers: ${co.cust}\n` +
                `Reputation: ${co.rep}/100\n\n` +
                `Continue building your empire!`;
            document.getElementById('victoryScreen').classList.remove('hidden');
        }

        function continueAfterVictory() { hideAll(); showReport(); }

        function showGameOver() {
            hideAll();
            const co = getCo();
            document.getElementById('gameOverContent').textContent = 
                `${co.name} declared bankruptcy.\n\n` +
                `Survived: ${co.month} months\n` +
                `Cash: $${co.cash.toLocaleString()}\n` +
                (companies.length > 1 ? `\nYou have ${companies.length - 1} other company/companies.` : '');
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        function closeCompany() {
            if (companies.length > 1) {
                companies.splice(activeIdx, 1);
                activeIdx = Math.max(0, activeIdx - 1);
                updateSelector();
                hideAll();
                showReport();
            } else {
                resetGame();
            }
        }

        function resetGame() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            companies = [];
            activeIdx = 0;
            nextId = 1;
            selectedBiz = null;
            document.querySelectorAll('.business-type').forEach(el => el.classList.remove('selected'));
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            selectBusiness('tech');
        });

        selectBusiness('tech');
    </script>
</body>
</html>
